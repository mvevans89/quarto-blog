{"title":"Extract Data From Spatial Polygons","markdown":{"yaml":{"title":"Extract Data From Spatial Polygons","description":"How to add zeros (or other characters) to the front of a string vector","author":"Michelle Evans","date":"2020-02-22","editor":"source","draft":false,"image":"overlay-img.png"},"headingText":"install.packages(\"USAboundariesData\", repos = \"http://packages.ropensci.org\")","containsRefs":false,"markdown":"\n\nIf you work with spatial data, you are probably familiar with the `extract` function from the raster package, which extracts values from a RasterLayer or RasterStack to polygons or points. This is the type of function you may use when you want to know the elevation at a latitude/longitude value or the mean temperature within a county polygon.\n\nThis function only works when you value you want to extract is in a raster. If you want to extract from a vector layer, you'll need to use another operation or function. This technique is a type of vector overlay that is similar to an [intersect operation](http://wiki.gis.com/wiki/index.php/Intersect).\n\n![](overlay-img.png)\n\nI'll go over the full workflow below, but the function is:\n\n```{r}\n#| eval: false\n\nst_join(points, polygons, join = st_intersects)\n```\n\nThis is from the `sf` package, and you provide it with the point and polygon vector data, both as sf objects.\n\nAs an example, I'll go through extracting state names to some random points.\n\nThe `USAboundaries` package has spatial data for the US. It can be installed from the ROpenSci repository.\n\n```{r}\n#| warning: false\n#| message: false\n\nlibrary(USAboundaries)\nlibrary(USAboundariesData)\nlibrary(sf)\nlibrary(ggplot2)\n\nstates <- us_states()\ncities <- us_cities()\n\n#due to an problem between differnt PROJ version, must manually set the CRS\nst_crs(states) <- 4326\nst_crs(cities) <- 4326\n```\n\nWe'll just choose 100 cities at random and plot them over the states to get an idea of what this looks like. I'm going to zoom in on the East Coast just for visualization purposes.\n\n```{r}\nsampled.cities <- cities[sample(1:nrow(cities), 100, replace = F),]\n\nggplot() +\n  geom_sf(data = states) +\n  geom_sf(data = sampled.cities) +\n  theme_void() +\n  coord_sf(xlim = c(-95,-60), ylim = c(25,50)) \n```\n\nWe'll drop some columns so it is easier to see how the extracted values are added to the dataset.\n\n```{r}\nsampled.cities <- dplyr::select(sampled.cities, city, state_name)\n\nhead(sampled.cities)\n```\n\nWe can then extract the values held in the polygons to the points. \n\n```{r}\n#| warning: false\n\npoint.extraction <- st_join(sampled.cities, states, join = st_intersects)\n\nhead(point.extraction)\n```\n\nThis extracts all of the columns from the `states` object to the city points, but you can also specify which columns you want by using `select` nested within the `st_join` function.\n\n```{r}\n#| warning: false\nstate.abbr.extraction <- st_join(sampled.cities, dplyr::select(states, state_abbr), \n                                 join = st_intersects)\n\nhead(state.abbr.extraction)\n```\n\nJust remember that when you want to \"extract\" polygons with `sf` what you are really doing is taking the results of a spatial `join` where the polygons `intersect`.","srcMarkdownNoYaml":"\n\nIf you work with spatial data, you are probably familiar with the `extract` function from the raster package, which extracts values from a RasterLayer or RasterStack to polygons or points. This is the type of function you may use when you want to know the elevation at a latitude/longitude value or the mean temperature within a county polygon.\n\nThis function only works when you value you want to extract is in a raster. If you want to extract from a vector layer, you'll need to use another operation or function. This technique is a type of vector overlay that is similar to an [intersect operation](http://wiki.gis.com/wiki/index.php/Intersect).\n\n![](overlay-img.png)\n\nI'll go over the full workflow below, but the function is:\n\n```{r}\n#| eval: false\n\nst_join(points, polygons, join = st_intersects)\n```\n\nThis is from the `sf` package, and you provide it with the point and polygon vector data, both as sf objects.\n\nAs an example, I'll go through extracting state names to some random points.\n\nThe `USAboundaries` package has spatial data for the US. It can be installed from the ROpenSci repository.\n\n```{r}\n#| warning: false\n#| message: false\n\n# install.packages(\"USAboundariesData\", repos = \"http://packages.ropensci.org\")\nlibrary(USAboundaries)\nlibrary(USAboundariesData)\nlibrary(sf)\nlibrary(ggplot2)\n\nstates <- us_states()\ncities <- us_cities()\n\n#due to an problem between differnt PROJ version, must manually set the CRS\nst_crs(states) <- 4326\nst_crs(cities) <- 4326\n```\n\nWe'll just choose 100 cities at random and plot them over the states to get an idea of what this looks like. I'm going to zoom in on the East Coast just for visualization purposes.\n\n```{r}\nsampled.cities <- cities[sample(1:nrow(cities), 100, replace = F),]\n\nggplot() +\n  geom_sf(data = states) +\n  geom_sf(data = sampled.cities) +\n  theme_void() +\n  coord_sf(xlim = c(-95,-60), ylim = c(25,50)) \n```\n\nWe'll drop some columns so it is easier to see how the extracted values are added to the dataset.\n\n```{r}\nsampled.cities <- dplyr::select(sampled.cities, city, state_name)\n\nhead(sampled.cities)\n```\n\nWe can then extract the values held in the polygons to the points. \n\n```{r}\n#| warning: false\n\npoint.extraction <- st_join(sampled.cities, states, join = st_intersects)\n\nhead(point.extraction)\n```\n\nThis extracts all of the columns from the `states` object to the city points, but you can also specify which columns you want by using `select` nested within the `st_join` function.\n\n```{r}\n#| warning: false\nstate.abbr.extraction <- st_join(sampled.cities, dplyr::select(states, state_abbr), \n                                 join = st_intersects)\n\nhead(state.abbr.extraction)\n```\n\nJust remember that when you want to \"extract\" polygons with `sf` what you are really doing is taking the results of a spatial `join` where the polygons `intersect`."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"toc-depth":3,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","theme":"minty","title-block-banner":false,"title":"Extract Data From Spatial Polygons","description":"How to add zeros (or other characters) to the front of a string vector","author":"Michelle Evans","date":"2020-02-22","editor":"source","draft":false,"image":"overlay-img.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}