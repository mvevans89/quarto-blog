{
  "hash": "a2e6ca27adaa2275b5061bae37f29db3",
  "result": {
    "markdown": "---\ntitle: \"C'est où, Paris?\"\ndescription: \"Day 1 of the #30DayMapChallenge - Points\"\nauthor: \"Michelle Evans\"\ndate: \"2022-11-01\"\ndraft: false\nimage: day1-paris.png\nexecute:\n  warning: false\n  message: false\n---\n\n\nThis is the start of the [#30DayMappingChallenge](https://github.com/tjukanovt/30DayMapChallenge). The first day's topic is \"points\". For this I'm going to mapping all the cities called Paris in the United States. This has a couple of steps:\n\n1. Georeference the cities to get their GPS coordinates\n2. Download a basemap of the outline of the US\n3. Map a make!\n\nHere's the packages we'll use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tmaptools) #to georeference city names\nlibrary(maps) #to download map of US\nlibrary(ggimage) #custom point markers\nlibrary(showtext) #for french-style font\n\nlibrary(ggplot2)\n\nlibrary(dplyr)\n```\n:::\n\n\n# Georeference city names\n\nFirst, we need to get the GPS coordinates from the city names. There are 23 cities with names *closely* approximating Paris in the US. We can find their coordinates using the `geocode_OSM` function from `tmaptools` which works with the OpenStreetMap API. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nparis.cities <- c(\"Perris, California\", \"Paris, Idaho\", \"Paris, Texas\",\n                  \"Paris, Arkansas\", \"Paris, Missouri\", \"Paris, Grant County, Wisconsin\",\n                  \"Paris, Kenosha County, Wisconsin\", \"Paris, Illinois\", \"Paris, Tennessee\",\n                  \"Paris, Kentucky\", \"New Paris, Ohio\", \"St. Paris, Ohio\", \"New Paris, Indiana\",\n                  \"Paris, Michigan\", \"Paris Township, Michigan\", \"Paris, Ohio\", \n                  \"Paris, Pennsylvania\", \"New Paris, Pennsylvania\", \"Paris, Virginia\",\n                  \"Paris, New York\", \"South Paris, Maine\", \"Paris, Maine\", \"West Paris, Maine\")\n\nparis.geo <- geocode_OSM(q = paris.cities, details = FALSE, as.data.frame = TRUE)\n\n#extract just the query and coordinates & turn into \n#an sf object\nparis.coords <- select(paris.geo, query, lat, lon) %>%\n  st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326)\n```\n:::\n\n\nNote that `st_as_sf` wants the coords in form of `c(x,y)` or `c('lon', 'lat')`. Remember lat = flat (y-axis).\n\n# Download a basemap of the US\n\nI want an outline of the US to use a background or basemap for this map. There are lots of ways of downloading spatial polygons of the US in R, listed on this super helpful [blogpost](https://jtr13.github.io/cc19/different-ways-of-plotting-u-s-map-in-r.html). I will use the `maps` package because it converts easily into an `sf` object. This specific call only returns the contiguous US.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nusa.poly <- st_as_sf(maps::map(\"state\", fill=TRUE, plot =FALSE))\n```\n:::\n\n\nWe can plot this to ensure it works using `ggplot`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(usa.poly) +\n  geom_sf() +\n  coord_sf(crs = 5070)+ \n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nI've done two small changes here. First, I update the coordinate system to Albers Conus/ NAD 83, which looks better for the US (IMO). I also use `theme_void` which drops all grid lines and axes, so all we see is the polygons.\n\n# Make a map!\n\nWe can then put this altogether into one map, using the defaults for now:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = usa.poly) +\n  geom_sf(data = paris.coords) +\n  coord_sf(crs = 5070) + \n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Set up custom point markers\n\nThe default point marker in `ggplot` is a circle, corresponding to shape `20`. While you can easily change the shape to any other [ready-made shapes in ggplot](https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#point), I want to use a custom marker of the Eiffel tower. We can try to do this using the `geom_image` function from `ggimage`, but we will get an error because `ggimage` doesn't work out of the box with `sf` objects:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = usa.poly) +\n  geom_image(data = paris.coords, image = \"eiffel-tower.png\") +\n  coord_sf(crs = 5070) + \n  theme_void()\n\n#Error in `check_required_aesthetics()`:\n#! geom_image requires the following missing aesthetics: x and y\n```\n:::\n\n\nSo we will need to convert the coordinates into points with x and y coordinates, making sure they are using the same Albers CRS as the US background map:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparis.xy <- paris.coords %>%\n  #reproject\n  st_transform(crs = 5070) %>%\n  #get x and y coordinates\n  mutate(x = st_coordinates(.)[,1],\n         y = st_coordinates(.)[,2]) %>%\n  #drop sf geometry\n  st_drop_geometry()\n```\n:::\n\n\nNow we can try to plot again:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = usa.poly) +\n  geom_image(data = paris.xy, aes(x = x, y = y), image = \"eiffel-tower.png\", size = 0.05) +\n  coord_sf(crs = 5070) + \n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Turn the US into a French flag\n\nThe map still feels like it is missing a certain *je ne sais quoi*, so I will turn the US background into a French flag to give it some flair. To do this, we'll need to split the US into thirds that we will plot separately. We can split the US into grids using the `st_make_grid` function to create three evenly spaced grids. The `n` argument of the function allows us to specify that we want 3 columns and 1 row, and the function will split these into equal size:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create outline of whole US, dropping shape outlines\n#switch off s2 due to spherical errors\nsf_use_s2(FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSpherical geometry (s2) switched off\n```\n:::\n\n```{.r .cell-code}\nus.outline <- st_union(usa.poly)\n#turn s2 back on\nsf_use_s2(TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSpherical geometry (s2) switched on\n```\n:::\n\n```{.r .cell-code}\nus.grid <- st_make_grid(us.outline, n = c(3,1))\n\nggplot() +\n  geom_sf(data = us.outline) +\n  geom_sf(data = us.grid, fill = NA) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nNext we will intersect this grid with the US polygon to create three US shaped polygons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus.thirds <- as.data.frame(st_intersection(us.outline, us.grid)) %>%\n  #just make color factors\n  mutate(color = c(letters[1:3])) %>%\n  st_as_sf()\n\n#palette of french flag\nfrench_palette <- c(\"#002654\", \"#FFFFFF\", \"#ED2939\")\n\nggplot(us.thirds) +\n  geom_sf(aes(fill = color)) +\n  scale_fill_manual(values = french_palette)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nThen we can put it all together, adding some nice small formatting finishing touches. Some of this uses custom fonts via the `showtext` package, so may not be fully reproducible on your machine.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshowtext_auto()\nggplot() +\n  geom_sf(data = usa.poly, fill = NA, size = 0.1, alpha = 0.4, color = \"gray80\") +\n  geom_sf(data = us.thirds, aes(fill = color), alpha = 0.5, size = 0) +\n  geom_image(data = paris.xy, aes(x = x, y = y), image = \"eiffel-tower.png\", size = 0.04) +\n  geom_sf(data = us.outline, color = \"gray50\", fill = NA) +\n  coord_sf(crs = 5070) + \n  scale_fill_manual(values = french_palette) +\n  guides(fill = 'none') +\n  theme_void() +\n  labs(title = \"C'est où, Paris?\",\n       subtitle = \"Finding the 'City of Light' in the USA\") +\n  theme(plot.title = element_text(family = \"parisish\", size = 16),\n       plot.subtitle = element_text(family = \"parisish\", size = 12))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}